<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏功能测试</title>
</head>
<body>
    <h1>游戏功能测试</h1>
    <div id="test-results"></div>
    
    <script src="events.js"></script>
    <script src="actions.js"></script>
    <script>
        // 测试基本功能
        function runTests() {
            const results = [];
            
            // 测试1: 检查ACTION_TYPES是否正确定义
            try {
                if (typeof ACTION_TYPES === 'object' && ACTION_TYPES.AMPLIFY === 'amplify') {
                    results.push('✅ ACTION_TYPES 正确定义');
                } else {
                    results.push('❌ ACTION_TYPES 定义错误');
                }
            } catch (e) {
                results.push('❌ ACTION_TYPES 访问失败: ' + e.message);
            }
            
            // 测试2: 检查actionPool是否有数据
            try {
                if (typeof actionPool === 'object' && actionPool[0] && actionPool[0][ACTION_TYPES.AMPLIFY]) {
                    results.push('✅ actionPool 数据结构正确');
                } else {
                    results.push('❌ actionPool 数据结构错误');
                }
            } catch (e) {
                results.push('❌ actionPool 访问失败: ' + e.message);
            }
            
            // 测试3: 检查getActionsForStage函数
            try {
                const stage0Actions = getActionsForStage(0);
                if (Array.isArray(stage0Actions) && stage0Actions.length > 0) {
                    results.push('✅ getActionsForStage(0) 返回 ' + stage0Actions.length + ' 个行动');
                } else {
                    results.push('❌ getActionsForStage(0) 返回空或错误');
                }
            } catch (e) {
                results.push('❌ getActionsForStage 函数错误: ' + e.message);
            }
            
            // 测试4: 检查getContextualActions函数
            try {
                const mockGameState = {
                    stageIdx: 0,
                    resources: { population: 50, food: 30, tech: 10, environment: 60 }
                };
                const contextualActions = getContextualActions(null, mockGameState, 4);
                if (Array.isArray(contextualActions) && contextualActions.length > 0) {
                    results.push('✅ getContextualActions 返回 ' + contextualActions.length + ' 个行动');
                } else {
                    results.push('❌ getContextualActions 返回空或错误');
                }
            } catch (e) {
                results.push('❌ getContextualActions 函数错误: ' + e.message);
            }
            
            // 测试5: 检查所有阶段是否都有行动
            try {
                let allStagesHaveActions = true;
                for (let i = 0; i <= 6; i++) {
                    const stageActions = getActionsForStage(i);
                    if (!stageActions || stageActions.length === 0) {
                        allStagesHaveActions = false;
                        results.push('❌ 阶段 ' + i + ' 没有行动');
                    }
                }
                if (allStagesHaveActions) {
                    results.push('✅ 所有阶段 (0-6) 都有行动');
                }
            } catch (e) {
                results.push('❌ 阶段检查错误: ' + e.message);
            }
            
            // 测试6: 检查事件系统
            try {
                if (typeof getEventsForStageTurn === 'function') {
                    const stage0Events = getEventsForStageTurn(0);
                    if (Array.isArray(stage0Events) && stage0Events.length > 0) {
                        results.push('✅ 事件系统正常，阶段0有 ' + stage0Events.length + ' 个事件');
                    } else {
                        results.push('❌ 阶段0事件为空');
                    }
                } else {
                    results.push('❌ getEventsForStageTurn 函数未定义');
                }
            } catch (e) {
                results.push('❌ 事件系统错误: ' + e.message);
            }
            
            // 显示结果
            document.getElementById('test-results').innerHTML = 
                '<h2>测试结果:</h2>' + 
                results.map(result => '<p>' + result + '</p>').join('');
        }
        
        // 页面加载完成后运行测试
        window.onload = runTests;
    </script>
</body>
</html>
